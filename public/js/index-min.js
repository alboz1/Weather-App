const app={weekDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],celsius:!0,unit:"metric",init(){"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),this.getCurrentLocationWeather(),controllers.searchCity(),controllers.switchUnits()},getCurrentLocationWeather(){if("geolocation"in navigator){const e={timeout:1e4};navigator.geolocation.getCurrentPosition(e=>{this.getWeatherData({currentWeather:`/current-weather/?lat=${e.coords.latitude}&lon=${e.coords.longitude}&units=${this.unit}`,forecastWeather:`/forecast-weather/?lat=${e.coords.latitude}&lon=${e.coords.longitude}&units=${this.unit}`})},e=>{view.showError(e,"Please enable location in your settings")},e)}else console.log("Your browser does not support geolocation")},getWeatherData(e){const t=axios.get(e.currentWeather),n=axios.get(e.forecastWeather);Promise.all([t,n]).then(e=>{const[t,n]=e;document.querySelector('button[type="submit"]').removeAttribute("disabled"),document.querySelector(".spinner").style.display="none",view.showCurrentWeather({city:t.data.name,temperature:t.data.main.temp,feelsLike:t.data.main.feels_like,icon:t.data.weather[0].id,info:t.data.weather[0].description,hours:t.data.dt}),view.countryInfo(t.data,t.data.sys.country),view.showForecast({forecasts:n.data.list})}).catch(e=>{view.showError(e)})},nightDayIcons:(e,t)=>t>=0&&t<5?`wi wi-owm-night-${e}`:t>=5&&t<11?`wi wi-owm-day${e}`:t>=11&&t<18?`wi wi-owm-${e}`:t>=18&&t<=23?`wi wi-owm-night-${e}`:void 0,convertTemp(){document.querySelectorAll(".deg").forEach(e=>{const t=Number(e.textContent.includes("Feels")?e.textContent.split(" ")[2]:e.textContent.split(" ")[0]);if(app.celsius){const n=Math.round(5*(t-32)/9);e.textContent=e.textContent.includes("Feels")?`Feels like ${n} °C`:`${n} °C`}else{const n=Math.round(9*t/5+32);e.textContent=e.textContent.includes("Feels")?`Feels like ${n} °F`:`${n} °F`}})}},view={showCurrentWeather(e){document.querySelector("main").style.display="block",document.querySelector(".error").style.display="none";const t=document.querySelector(".info"),n=document.querySelector(".city-name"),o=document.querySelector(".temperature"),r=document.querySelector(".feels-like"),s=document.querySelector(".weather-icon i"),a=document.querySelector(".weather-info-text");t.style.display="flex",n.textContent=e.city,o.textContent=`${Math.round(e.temperature)}${app.celsius?" °C":" °F"}`,r.textContent=`Feels like ${Math.round(e.feelsLike)}${app.celsius?" °C":" °F"}`,s.className=app.nightDayIcons(e.icon,new Date(1e3*e.hours).getHours()),a.textContent=e.info},showForecast(e){const t=document.querySelector(".week-weather-info");t.innerHTML="",e.forecasts.shift(),e.forecasts.forEach(e=>{let n=new Date(1e3*e.dt).getUTCDay();const o=`\n            <div class="day-wrapper">\n                <h3 class="week-day">\n                    ${app.weekDays[n]}\n                    <span class="deg">${Math.round(e.temp.max)} &deg;${app.celsius?"C":"F"}</span>\n                    <span class="deg">${Math.round(e.temp.min)} &deg;${app.celsius?"C":"F"}</span>\n                </h3>\n                <i class="wi wi-owm-${e.weather[0].id}"></i>\n                <p>${e.weather[0].main}</p>\n            </div>`;t.innerHTML+=o})},countryInfo(e,t){const n=new Date(1e3*(e.dt+e.timezone)),o=n.getUTCDate(),r=app.weekDays[n.getUTCDay()],s=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"][n.getUTCMonth()],a=n.getUTCFullYear();document.querySelector(".city-info").textContent=`${t||""} ${r} ${s} ${o} ${a}`},showError(e,t){const n=document.querySelector(".error"),o=document.querySelector(".info");if(document.querySelector('button[type="submit"]').removeAttribute("disabled"),document.querySelector(".spinner").style.display="none",o.style.display="none",document.querySelector("main").style.display="none",n.style.display="block",t)return void(n.textContent=t);const r=e.response.data.message.charAt(0).toUpperCase()+e.response.data.message.slice(1);n.textContent=r}},controllers={searchCity(){const e=document.querySelector("#search-form"),t=e.querySelector("button");e.addEventListener("submit",function(e){e.preventDefault(),document.querySelector(".spinner").style.display="flex",t.setAttribute("disabled","true");let n=document.querySelector("#search-field").value;app.getWeatherData({currentWeather:`/current-weather/?units=${app.unit}&q=${n}`,forecastWeather:`/forecast-weather/?units=${app.unit}&q=${n}`})})},switchUnits(){document.querySelector(".units-switch").addEventListener("click",function(){const e=this.querySelector(".switch");e.classList.toggle("switched"),app.celsius=!app.celsius,app.unit=app.celsius?"metric":"imperial",e.innerHTML=app.celsius?"C&deg;":"F&deg;",app.convertTemp()})}};app.init();