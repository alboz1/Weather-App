const app={weekDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],celsius:!0,unit:"metric",init(){"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),this.getCurrentLocationWeather(),controllers.searchCity(),controllers.switchUnits()},getCurrentLocationWeather(){if("geolocation"in navigator){const e={timeout:1e4};navigator.geolocation.getCurrentPosition(e=>{this.getWeatherData({currentWeather:`/current-weather/?lat=${e.coords.latitude}&lon=${e.coords.longitude}&units=${this.unit}`,forecastWeather:`/forecast-weather/?lat=${e.coords.latitude}&lon=${e.coords.longitude}&units=${this.unit}`})},e=>{view.showError(e,"Please enable location to immediately see your local weather or you can search for it.")},e)}else console.log("Your browser does not support geolocation")},getWeatherData(e){const t=axios.get(e.currentWeather),o=axios.get(e.forecastWeather);Promise.all([t,o]).then(e=>{const[t,o]=e;document.querySelector('button[type="submit"]').removeAttribute("disabled"),document.querySelector(".spinner").style.display="none",view.showCurrentWeather({city:t.data.name,temperature:t.data.main.temp,feelsLike:t.data.main.feels_like,wind:t.data.wind.speed,temp_max:t.data.main.temp_max,temp_min:t.data.main.temp_min,icon:t.data.weather[0].id,info:t.data.weather[0].description,hours:t.data.dt}),view.countryInfo(t.data,t.data.sys.country),view.showForecast({forecasts:o.data.list})}).catch(e=>{view.showError(e)})},nightDayIcons:(e,t)=>t>=0&&t<5?`wi wi-owm-night-${e}`:t>=5&&t<11?`wi wi-owm-day${e}`:t>=11&&t<18?`wi wi-owm-${e}`:t>=18&&t<=23?`wi wi-owm-night-${e}`:void 0,convertTemp(){document.querySelectorAll(".deg").forEach(e=>{const t=Number(e.textContent);if(app.celsius){const o=Math.round(5*(t-32)/9);e.textContent=o}else{const o=Math.round(9*t/5+32);e.textContent=o}})}},view={showCurrentWeather(e){document.querySelector("main").style.display="block",document.querySelector(".error").style.display="none";const t=document.querySelector(".info"),o=document.querySelector(".city-name"),n=document.querySelector(".temperature"),r=document.querySelector(".feels-like"),a=document.querySelector(".wind"),i=document.querySelector(".high"),s=document.querySelector(".low"),c=document.querySelector(".weather-icon i"),u=document.querySelector(".weather-info-text");t.style.display="flex",o.textContent=e.city,n.textContent=Math.round(e.temperature),r.textContent=Math.round(e.feelsLike),a.textContent=`Wind: ${Math.round(3.6*e.wind)} km/h`,i.textContent=Math.round(e.temp_max),s.textContent=Math.round(e.temp_min),c.className=app.nightDayIcons(e.icon,new Date(1e3*e.hours).getHours()),u.textContent=e.info},showForecast(e){const t=document.querySelector(".week-weather-info");t.innerHTML="",e.forecasts.shift(),e.forecasts.forEach(e=>{let o=new Date(1e3*e.dt).getUTCDay();const n=`\n            <div class="day-wrapper">\n                <h3 class="week-day">\n                    ${app.weekDays[o]}\n                    <span class="deg">${Math.round(e.temp.max)}</span>\n                    <span class="deg">${Math.round(e.temp.min)}</span>\n                </h3>\n                <i class="wi wi-owm-${e.weather[0].id}"></i>\n                <p>${e.weather[0].main}</p>\n            </div>`;t.innerHTML+=n})},countryInfo(e,t){const o=new Date(1e3*(e.dt+e.timezone)),n=o.getUTCDate(),r=app.weekDays[o.getUTCDay()],a=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"][o.getUTCMonth()],i=o.getUTCFullYear();document.querySelector(".city-info").textContent=`${t||""} ${r} ${a} ${n} ${i}`},showError(e,t){const o=document.querySelector(".error"),n=document.querySelector(".info");if(document.querySelector('button[type="submit"]').removeAttribute("disabled"),document.querySelector(".spinner").style.display="none",n.style.display="none",document.querySelector("main").style.display="none",o.style.display="block",t)return void(o.textContent=t);const r=e.response.data.message.charAt(0).toUpperCase()+e.response.data.message.slice(1);o.textContent=r}},controllers={searchCity(){const e=document.querySelector("#search-form"),t=e.querySelector("button");e.addEventListener("submit",function(e){e.preventDefault(),document.querySelector(".spinner").style.display="flex",t.setAttribute("disabled","true");let o=document.querySelector("#search-field").value;app.getWeatherData({currentWeather:`/current-weather/?units=${app.unit}&q=${o}`,forecastWeather:`/forecast-weather/?units=${app.unit}&q=${o}`})})},switchUnits(){document.querySelector(".units-switch").addEventListener("click",function(){const e=this.querySelector(".switch");e.classList.toggle("switched"),app.celsius=!app.celsius,app.unit=app.celsius?"metric":"imperial",e.innerHTML=app.celsius?"C&deg;":"F&deg;",app.convertTemp()})}};app.init();