const app={weekDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],celsius:!0,unit:"metric",init(){"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),this.getCurrentLocationWeather(),view.eventListeners()},getCurrentLocationWeather(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{this.currentWeatherData(`/current-weather/?${e.coords.latitude},${e.coords.longitude},${this.unit}`),this.getWeatherForecast(`/forecast-weather/?${e.coords.latitude},${e.coords.longitude},${this.unit}`)}):console.log("Your browser does not support geolocation")},currentWeatherData:e=>axios.get(e).then(e=>{view.showCurrentWeather({city:e.data.name,deg:e.data.main.temp,icon:e.data.weather[0].id,info:e.data.weather[0].description,hours:e.data.dt}),view.countryInfo(e.data,e.data.sys.country)}).catch(e=>{console.log(e.response);const t=document.querySelector(".error");document.querySelector("main").style.display="none",t.style.display="block",e.response||(t.textContent="Please connect to internet",console.log(e)),404===e.response.status&&(t.textContent="Sorry, city not found")}),getWeatherForecast:e=>axios.get(e).then(e=>{view.showForecast({forecasts:e.data.list})}).catch(e=>{console.log(e)}),nightDayIcons:(e,t)=>t>=0&&t<5?`wi wi-owm-night-${e}`:t>=5&&t<11?`wi wi-owm-day${e}`:t>=11&&t<18?`wi wi-owm-${e}`:t>=18&&t<=23?`wi wi-owm-night-${e}`:void 0},view={showCurrentWeather(e){document.querySelector("main").style.display="block",document.querySelector(".error").style.display="none";const t=document.querySelector(".city-name"),o=document.querySelector(".deg"),n=document.querySelector(".weather-icon i"),r=document.querySelector(".weather-info-text");t.textContent=e.city,o.innerHTML=`${Math.round(e.deg)}${app.celsius?"&deg;C":"&deg;F"}`,n.className=app.nightDayIcons(e.icon,new Date(1e3*e.hours).getHours()),r.textContent=e.info},showForecast(e){const t=document.querySelector(".week-weather-info");t.innerHTML="",e.forecasts.shift(),e.forecasts.forEach(e=>{let o=new Date(1e3*e.dt).getUTCDay();const n=`\n            <div class="day-wrapper">\n                <h3 class="week-day">${app.weekDays[o]} <span class="deg">${Math.round(e.temp.day)}&deg;C</span></h3>\n                <i class="wi wi-owm-${e.weather[0].id}"></i>\n                <p>${e.weather[0].main}</p>\n            </div>`;t.innerHTML+=n})},countryInfo(e,t){const o=new Date(1e3*(e.dt+e.timezone)),n=o.getUTCDate(),r=app.weekDays[o.getUTCDay()],a=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"][o.getUTCMonth()],i=o.getUTCFullYear();document.querySelector(".city-info").textContent=`${t||""} ${r} ${a} ${n} ${i}`},eventListeners(){const e=document.querySelector("#search-form"),t=document.querySelector(".units-switch");e.addEventListener("submit",function(e){e.preventDefault();const t=document.querySelector("#search-field").value;""!==t&&(app.currentWeatherData(`/current-weather/?${app.unit},${t}`),app.getWeatherForecast(`/forecast-weather/?${app.unit},${t}`))}),t.addEventListener("click",function(){const e=this.querySelector(".switch");e.classList.toggle("switched"),app.celsius=!app.celsius,app.unit=app.celsius?"metric":"imperial",e.innerHTML=app.celsius?"C&deg;":"F&deg;"})}};app.init();